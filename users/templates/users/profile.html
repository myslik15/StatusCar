{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static "css/auth.css" %}">
<link rel="stylesheet" href="{% static "css/profile.css" %}">
{% endblock extra_css %}

{% block content %}
    <main class="profile-main">
        <div class="profile-container container">
            <!-- Боковая панель -->
            <aside class="profile-sidebar">
                <div class="user-card">
                    <div class="user-info">
                        <h3>{{ user.first_name }} {{ user.last_name }}</h3>
                        <p class="user-email">{{ user.email }}</p>
                        <p class="user-phone">{{ user.profile.phone|default:"Телефон не указан" }}</p>
                        <div class="user-stats">
                            <div class="stat-item">
                                <span class="stat-number">{{ user_ads_count|default:0 }}</span>
                                <span class="stat-label">Объявления</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">{{ user_favorites_count|default:0 }}</span>
                                <span class="stat-label">Избранное</span>
                            </div>
                        </div>
                    </div>
                </div>

                <nav class="profile-nav">
                    <a href="#personal" class="nav-item active" data-tab="personal">
                        Личные данные
                    </a>
                    <a href="#security" class="nav-item" data-tab="security">
                        Безопасность
                    </a>
                    <a href="#notifications" class="nav-item" data-tab="notifications">
                        Уведомления
                    </a>
                    <a href="#preferences" class="nav-item" data-tab="preferences">
                        Настройки
                    </a>
                </nav>
            </aside>

            <!-- Основной контент -->
            <div class="profile-content">
                <!-- Вкладка личных данных -->
                <div class="tab-content active" id="personal-tab">
                    <div class="content-header">
                        <h2>Личные данные</h2>
                        <p>Управляйте вашей персональной информацией</p>
                    </div>

                    <form class="profile-form" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="personal">

                        {% if messages %}
                        <div class="profile-messages">
                            {% for message in messages %}
                            <div class="message {{ message.tags }}">{{ message }}</div>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <div class="form-section">
                            <h4>Основная информация</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="first_name">Имя</label>
                                    <input type="text" id="first_name" name="first_name" value="{{ user.first_name }}" required>
                                </div>
                                <div class="form-group">
                                    <label for="last_name">Фамилия</label>
                                    <input type="text" id="last_name" name="last_name" value="{{ user.last_name }}" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4>Контактная информация</h4>
                            <div class="form-group">
                                <label for="email">Электронная почта</label>
                                <input type="email" id="email" name="email" value="{{ user.email }}" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Телефон</label>
                                <input type="tel" id="phone" name="phone" value="{{ user.profile.phone|default:'' }}" placeholder="+375 (XX) XXX-XX-XX">
                            </div>
                        </div>

                        <div class="form-section">
                            <h4>Дополнительная информация</h4>
                            <div class="form-group">
                                <label for="city">Город</label>
                                <input type="text" id="city" name="city" value="{{ user.profile.city|default:'' }}" placeholder="Ваш город">
                            </div>
                            <div class="form-group">
                                <label for="birth_date">Дата рождения</label>
                                <input type="date" id="birth_date" name="birth_date" value="{{ user.profile.birth_date|default:'' }}">
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="save-btn">Сохранить изменения</button>
                            <button type="reset" class="cancel-btn">Отмена</button>
                        </div>
                    </form>
                </div>

                <!-- Вкладка безопасности -->
                <div class="tab-content" id="security-tab">
                    <div class="content-header">
                        <h2>Безопасность</h2>
                        <p>Управление паролем и настройками безопасности</p>
                    </div>

                    <form class="profile-form" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="security">

                        <div class="form-section">
                            <h4>Смена пароля</h4>
                            <div class="form-group">
                                <label for="current_password">Текущий пароль</label>
                                <input type="password" id="current_password" name="current_password">
                                <button type="button" class="toggle-password">
                                    <img src="{% static "icons/eye-open.png" %}" alt="Показать пароль" width="20" height="20">
                                </button>
                            </div>
                            <div class="form-group">
                                <label for="new_password">Новый пароль</label>
                                <input type="password" id="new_password" name="new_password">
                                <button type="button" class="toggle-password">
                                    <img src="{% static "icons/eye-open.png" %}" alt="Показать пароль" width="20" height="20">
                                </button>
                                <div class="password-strength">
                                    <div class="strength-bar"></div>
                                    <span class="strength-text">Надежность пароля</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="confirm_password">Подтвердите новый пароль</label>
                                <input type="password" id="confirm_password" name="confirm_password">
                                <button type="button" class="toggle-password">
                                    <img src="{% static "icons/eye-open.png" %}" alt="Показать пароль" width="20" height="20">
                                </button>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4>Двухфакторная аутентификация</h4>
                            <div class="security-option">
                                <div class="option-info">
                                    <h5>Двухфакторная аутентификация</h5>
                                    <p>Дополнительная защита вашего аккаунта</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" name="two_factor" {% if user.profile.two_factor_enabled %}checked{% endif %}>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="save-btn">Обновить настройки безопасности</button>
                        </div>
                    </form>
                </div>

                <!-- Вкладка уведомлений -->
                <div class="tab-content" id="notifications-tab">
                    <div class="content-header">
                        <h2>Уведомления</h2>
                        <p>Настройте получение уведомлений</p>
                    </div>

                    <form class="profile-form" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="notifications">

                        <div class="form-section">
                            <h4>Настройки уведомлений</h4>
                            
                            <div class="notification-option">
                                <div class="option-info">
                                    <h5>Email уведомления</h5>
                                    <p>Получать уведомления на электронную почту</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" name="email_notifications" {% if user.profile.email_notifications %}checked{% endif %}>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="notification-option">
                                <div class="option-info">
                                    <h5>Новые автомобили</h5>
                                    <p>Уведомления о новых автомобилях по вашим критериям</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" name="new_cars_notifications" {% if user.profile.new_cars_notifications %}checked{% endif %}>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="notification-option">
                                <div class="option-info">
                                    <h5>Специальные предложения</h5>
                                    <p>Акции и специальные предложения от партнеров</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" name="promo_notifications" {% if user.profile.promo_notifications %}checked{% endif %}>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="notification-option">
                                <div class="option-info">
                                    <h5>Статус объявлений</h5>
                                    <p>Уведомления об изменении статуса ваших объявлений</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" name="ads_status_notifications" {% if user.profile.ads_status_notifications %}checked{% endif %}>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4>Частота уведомлений</h4>
                            <div class="form-group">
                                <label for="notification_frequency">Частота отправки уведомлений</label>
                                <select id="notification_frequency" name="notification_frequency">
                                    <option value="instant" {% if user.profile.notification_frequency == 'instant' %}selected{% endif %}>Мгновенно</option>
                                    <option value="daily" {% if user.profile.notification_frequency == 'daily' %}selected{% endif %}>Ежедневно</option>
                                    <option value="weekly" {% if user.profile.notification_frequency == 'weekly' %}selected{% endif %}>Еженедельно</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="save-btn">Сохранить настройки</button>
                        </div>
                    </form>
                </div>

                <!-- Вкладка настроек -->
                <div class="tab-content" id="preferences-tab">
                    <div class="content-header">
                        <h2>Настройки</h2>
                        <p>Персональные настройки аккаунта</p>
                    </div>

                    <div class="form-section">
                        <h4>Язык и регион</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="language">Язык</label>
                                <select id="language" name="language">
                                    <option value="ru" {% if user.profile.language == 'ru' %}selected{% endif %}>Русский</option>
                                    <option value="en" {% if user.profile.language == 'en' %}selected{% endif %}>English</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="currency">Валюта</label>
                                <select id="currency" name="currency">
                                    <option value="BYN" {% if user.profile.currency == 'BYN' %}selected{% endif %}>BYN</option>
                                    <option value="USD" {% if user.profile.currency == 'USD' %}selected{% endif %}>USD</option>
                                    <option value="EUR" {% if user.profile.currency == 'EUR' %}selected{% endif %}>EUR</option>
                                    <option value="RUB" {% if user.profile.currency == 'RUB' %}selected{% endif %}>RUB</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Внешний вид</h4>
                        <div class="form-group">
                            <label for="theme">Тема оформления</label>
                            <select id="theme" name="theme">
                                <option value="light" {% if user.profile.theme == 'light' %}selected{% endif %}>Светлая</option>
                                <option value="dark" {% if user.profile.theme == 'dark' %}selected{% endif %}>Темная</option>
                                <option value="auto" {% if user.profile.theme == 'auto' %}selected{% endif %}>Системная</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section danger-zone">
                        <h4>Опасная зона</h4>
                        <div class="danger-actions">
                            <div class="danger-action">
                                <div class="danger-info">
                                    <h5>Удалить аккаунт</h5>
                                    <p>Безвозвратно удалить ваш аккаунт и все данные</p>
                                </div>
                                <button type="button" class="danger-btn" id="deleteAccountBtn">Удалить аккаунт</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Модальное окно удаления аккаунта -->
    <div id="deleteAccountModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Удаление аккаунта</h3>
            <p>Вы уверены, что хотите удалить свой аккаунт? Это действие нельзя отменить.</p>
            <div class="modal-actions">
                <button class="danger-btn confirm" id="confirmDelete">Да, удалить аккаунт</button>
                <button class="cancel-btn" id="cancelDelete">Отмена</button>
            </div>
        </div>
    </div>
{% endblock content %}
    
{% block extra_js %}<script src="{% static "js/profile.js" %}"></script>{% endblock extra_js %}